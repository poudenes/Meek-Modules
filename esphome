esphome:
  name: "meek-kitchen"
  on_boot:
    priority: 600
    then:
      - switch.turn_on: touch_power

esp8266:
  board: esp01_1m
  restore_from_flash: true
  
preferences:
  flash_write_interval: 1min

logger:
  level: DEBUG
  
api:
  encryption:
    key: "HIDDEN"
  reboot_timeout: 15min

ota:
  safe_mode: true
  password: "HIDDEN"

wifi:
  ssid: HIDDEN
  password: HIDDEN
  reboot_timeout: 0s
  fast_connect: true
  manual_ip:
    static_ip: 192.168.100.207
    gateway: 192.168.100.1
    subnet: 255.255.255.0
    dns1: 192.168.100.1

light:
  - platform: neopixelbus
    default_transition_length: 0s
    type: GRB
    variant: 800KBPS
    pin: D4
    num_leds: 3
    name: "kitchen - Neopixel"
    restore_mode: ALWAYS_ON
    id: neopixel
  
  - platform: partition
    name: "kitchen Partition - neopixel1"
    restore_mode: ALWAYS_ON
    default_transition_length: 0s
    id: neopixel1
    segments:
      - id: neopixel
        from: 0
        to: 0
  
  - platform: partition
    name: "kitchen Partition - neopixel2"
    restore_mode: ALWAYS_ON
    default_transition_length: 0s
    id: neopixel2
    segments:
      - id: neopixel
        from: 1
        to: 1

   - platform: partition
    name: "kitchen Partition - neopixel2"
    restore_mode: ALWAYS_ON
    default_transition_length: 0s
    id: neopixel3
    segments:
      - id: neopixel
        from: 2
        to: 2

button:
  - platform: factory_reset
    name: "kitchen - reset"

switch:
  - platform: gpio
    pin: GPIO16 #D1
    name: "kitchen - Touch 1 power"
    id: touch_power

  - platform: safe_mode
    name: "kitchen - safe mode"

  - platform: template
    name: "kitchen - Switch 1"
    restore_state: true
    id: switch1
    optimistic: true

  - platform: template
    name: "kitchen - Switch 2"
    restore_state: true
    id: switch2
    optimistic: true

  - platform: template
    name: "kitchen - Switch 3"
    restore_state: true
    id: switch3
    optimistic: true

binary_sensor:
  - platform: gpio
    pin: GPIO14 #D6
    name: "kitchen - Touch 1"
    on_press:
      - switch.toggle: switch1
      - if:
          condition:
            switch.is_on: switch1
          then:
            - light.turn_on: 
                id: neopixel1
                brightness: 100%
                red: 0%
                green: 100%
                blue: 0%
      - if:
          condition:
            switch.is_off: switch1
          then:
            - if:
                condition:
                  lambda: 'return id(daytime).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 100%
                      green: 0%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(goodnight).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 10%
                      green: 0%
                      blue: 10%
            - if:
                condition:
                  lambda: 'return id(kodi).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 93%
                      green: 0%
                      blue: 93%
            - if:
                condition:
                  lambda: 'return id(evening).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 100%
                      green: 0%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(appletv).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 55%
                      green: 55%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(tv).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 0%
                      green: 25%
                      blue: 53%
            - if:
                condition:
                  lambda: 'return id(nintendo).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel1
                      brightness: 100%
                      red: 36%
                      green: 28%
                      blue: 55%

  - platform: gpio
    pin: GPIO12
    name: "kitchen - Touch 2"
    on_press:
      - switch.toggle: switch2
      - if:
          condition:
            switch.is_on: switch2
          then:
            - light.turn_on: 
                id: neopixel2
                brightness: 100%
                red: 0%
                green: 100%
                blue: 0%
      - if:
          condition:
            switch.is_off: switch2
          then:
            - if:
                condition:
                  lambda: 'return id(daytime).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 100%
                      green: 0%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(goodnight).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 10%
                      green: 0%
                      blue: 10%
            - if:
                condition:
                  lambda: 'return id(kodi).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 93%
                      green: 0%
                      blue: 93%
            - if:
                condition:
                  lambda: 'return id(evening).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 100%
                      green: 0%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(appletv).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 55%
                      green: 55%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(tv).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 0%
                      green: 25%
                      blue: 53%
            - if:
                condition:
                  lambda: 'return id(nintendo).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel2
                      brightness: 100%
                      red: 36%
                      green: 28%
                      blue: 55%

  - platform: gpio
    pin: GPIO13
    name: "kitchen - Touch 3"
    on_press:
      - switch.toggle: switch3
      - if:
          condition:
            switch.is_on: switch3
          then:
            - light.turn_on: 
                id: neopixel3
                brightness: 100%
                red: 0%
                green: 100%
                blue: 0%
      - if:
          condition:
            switch.is_off: switch3
          then:
            - if:
                condition:
                  lambda: 'return id(daytime).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 100%
                      green: 0%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(goodnight).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 10%
                      green: 0%
                      blue: 10%
            - if:
                condition:
                  lambda: 'return id(kodi).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 93%
                      green: 0%
                      blue: 93%
            - if:
                condition:
                  lambda: 'return id(evening).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 100%
                      green: 0%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(appletv).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 55%
                      green: 55%
                      blue: 0%
            - if:
                condition:
                  lambda: 'return id(tv).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 0%
                      green: 25%
                      blue: 53%
            - if:
                condition:
                  lambda: 'return id(nintendo).state == "on";'
                then:
                  - light.turn_on: 
                      id: neopixel3
                      brightness: 100%
                      red: 36%
                      green: 28%
                      blue: 55%

sensor:
  - platform: wifi_signal
    name: "kitchen - wifi Signal"
    update_interval: 60s

text_sensor:
  - platform: wifi_info
    ip_address:
      name: "kitchen - IP"
    ssid:
      name: "kitchen - SSID"
    bssid:
      name: "kitchen - BSSID"
    mac_address:
      name: "kitchen - Mac"

  - platform: version
    name: "kitchen - Version"
    hide_timestamp: true
  
  - platform: homeassistant
    name: "kitchen Daytime"
    entity_id: switch.scene_daytime
    id: "daytime"
    on_value:
      - if:
          condition:
            lambda: 'return id(daytime).state == "on";'
          then:
            - light.turn_on: 
                id: neopixel
                brightness: 100%
                red: 100%
                green: 0%
                blue: 0%

  - platform: homeassistant
    name: "kitchen Evening"
    entity_id: switch.scene_evening
    id: "evening"
    on_value:
      then:
        - if:
            condition:
              lambda: 'return id(evening).state == "on";'
            then:
              - light.turn_on: 
                  id: neopixel
                  brightness: 100%
                  red: 100%
                  green: 0%
                  blue: 0%

  - platform: homeassistant
    name: "kitchen TV"
    entity_id: switch.scene_tv
    id: "tv"
    on_value:
      then:
        - if:
            condition:
              lambda: 'return id(tv).state == "on";'
            then:
              - light.turn_on: 
                  id: neopixel
                  brightness: 100%
                  red: 0%
                  green: 25%
                  blue: 53%

  - platform: homeassistant
    name: "kitchen AppleTV"
    entity_id: switch.scene_appletv
    id: "appletv"
    on_value:
      then:
        - if:
            condition:
              lambda: 'return id(appletv).state == "on";'
            then:
              - light.turn_on: 
                  id: neopixel
                  brightness: 100%
                  red: 55%
                  green: 55%
                  blue: 0%

  - platform: homeassistant
    name: "kitchen Kodi"
    entity_id: switch.scene_kodi
    id: "kodi"
    on_value:
      then:
        - if:
            condition:
              lambda: 'return id(kodi).state == "on";'
            then:
              - light.turn_on: 
                  id: neopixel
                  brightness: 100%
                  red: 93%
                  green: 0%
                  blue: 93%

  - platform: homeassistant
    name: "kitchen Nintendo"
    entity_id: switch.scene_nintendo
    id: "nintendo"
    on_value:
      then:
        - if:
            condition:
              lambda: 'return id(nintendo).state == "on";'
            then:
              - light.turn_on: 
                  id: neopixel
                  brightness: 100%
                  red: 36%
                  green: 28%
                  blue: 55%

  - platform: homeassistant
    name: "kitchen Goodnight"
    entity_id: switch.scene_goodnight
    id: "goodnight"
    on_value:
      then:
      - if:
          condition:
            lambda: 'return id(goodnight).state == "on";'
          then:
            - light.turn_on: 
                id: neopixel
                brightness: 100%
                red: 10%
                green: 0%
                blue: 10%
